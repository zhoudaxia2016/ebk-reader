"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[896],{4473:(e,t,r)=>{function i(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}r.d(t,{A:()=>i})},8341:(e,t,r)=>{r.d(t,{A:()=>n});var i=0;function n(e){return"__private_"+i+++"_"+e}},2896:(e,t,r)=>{r.r(t),r.d(t,{EPUB:()=>Fe});var i=r(4473),n=r(8341);const o=(e,t)=>[-1,...t,e.length].reduce(((t,r)=>{var i;let{xs:n,a:o}=t;return{xs:null!==(i=null===n||void 0===n?void 0:n.concat([e.slice(o+1,r)]))&&void 0!==i?i:[],a:r}}),{}).xs,s=/\d/,a=/^epubcfi\((.*)\)$/,l=e=>e.replace(/[\^[\](),;=]/g,"^$&"),c=e=>a.test(e)?e:"epubcfi(".concat(e,")");d=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.join("!")};var d;const u=(e,t)=>((e,t)=>e.map(((e,r,i)=>t(e,r,i)?r:null)).filter((e=>null!=e)))(e,(e=>{let[r]=e;return r===t})),h=e=>{const t=[];let r;for(const[o,s]of e){if("/"===o)t.push({index:s});else{var i;const e=t[t.length-1];if(":"===o)e.offset=s;else if("~"===o)e.temporal=s;else if("@"===o)e.spatial=(null!==(i=e.spatial)&&void 0!==i?i:[]).concat(s);else if(";s"===o)e.side=s;else if("["===o){if("/"!==r||!s){var n;e.text=(null!==(n=e.text)&&void 0!==n?n:[]).concat(s);continue}e.id=s}}r=o}return t},f=e=>o(e,u(e,"!")).map(h),p=e=>{const t=(e=>{const t=[];let r,i,n="";const o=e=>(t.push(e),r=null,n=""),a=e=>(n+=e,i=!1);for(const c of Array.from(e.trim()).concat("")){var l;if("^"!==c||i){if("!"===r)o(["!"]);else if(","===r)o([","]);else if("/"===r||":"===r){if(s.test(c)){a(c);continue}o([r,parseInt(n)])}else if("~"===r){if(s.test(c)||"."===c){a(c);continue}o(["~",parseFloat(n)])}else if("@"===r){if(":"===c){o(["@",parseFloat(n)]),r="@";continue}if(s.test(c)||"."===c){a(c);continue}o(["@",parseFloat(n)])}else{if("["===r){";"!==c||i?","!==c||i?"]"!==c||i?a(c):o(["[",n]):(o(["[",n]),r="["):(o(["[",n]),r=";");continue}if(null!==(l=r)&&void 0!==l&&l.startsWith(";")){"="!==c||i?";"!==c||i?"]"!==c||i?a(c):o([r,n]):(o([r,n]),r=";"):(r=";".concat(n),n="");continue}}"/"!==c&&":"!==c&&"~"!==c&&"@"!==c&&"["!==c&&"!"!==c&&","!==c||(r=c)}else i=!0}return t})((e=>{var t,r;return null!==(t=null===(r=e.match(a))||void 0===r?void 0:r[1])&&void 0!==t?t:e})(e)),r=u(t,",");if(!r.length)return f(t);const[i,n,l]=o(t,r).map(f);return{parent:i,start:n,end:l}},v=e=>{var t,r;let{index:i,id:n,offset:o,temporal:s,spatial:a,text:c,side:d}=e;const u=d?";s=".concat(d):"";return"/".concat(i)+(n?"[".concat(l(n)).concat(u,"]"):"")+(null!=o&&i%2?":".concat(o):"")+(s?"~".concat(s):"")+(a?"@".concat(a.join(":")):"")+(c||!n&&d?"["+(null!==(t=null===c||void 0===c||null===(r=c.map(l))||void 0===r?void 0:r.join(","))&&void 0!==t?t:"")+u+"]":"")},m=e=>e.parent?[e.parent,e.start,e.end].map(m).join(","):e.map((e=>e.map(v).join(""))).join("!"),g=e=>c(m(e)),A=(e,t)=>{return"string"===typeof e?g(A(p(e),t)):e.parent?(r=e.parent,i=e[t?"end":"start"],r.slice(0,-1).concat([r[r.length-1].concat(i[0])]).concat(i.slice(1))):e;var r,i},y=e=>{let{nodeType:t}=e;return 3===t||4===t},b=e=>{let{nodeType:t}=e;return 1===t},w=(e,t)=>{const r=Array.from(e.childNodes).filter((e=>y(e)||b(e)));return t?r.map((e=>{const r=t(e);return r===NodeFilter.FILTER_REJECT?null:r===NodeFilter.FILTER_SKIP?w(e,t):e})).flat().filter((e=>e)):r},S=(e,t)=>{const r=w(e,t).reduce(((e,t)=>{let r=e[e.length-1];return r?y(t)?Array.isArray(r)?r.push(t):y(r)?e[e.length-1]=[r,t]:e.push(t):b(r)?e.push(null,t):e.push(t):e.push(t),e}),[]);return b(r[0])&&r.unshift("first"),b(r[r.length-1])&&r.push("last"),r.unshift("before"),r.push("after"),r},x=(e,t,r)=>{const{id:i}=t[t.length-1];if(i){const t=e.ownerDocument.getElementById(i);if(t)return{node:t,offset:0}}for(const{index:l}of t){var n,o;const t=e?S(e,r)[l]:null;if("first"===t)return{node:null!==(n=e.firstChild)&&void 0!==n?n:e};if("last"===t)return{node:null!==(o=e.lastChild)&&void 0!==o?o:e};if("before"===t)return{node:e,before:!0};if("after"===t)return{node:e,after:!0};e=t}const{offset:s}=t[t.length-1];if(!Array.isArray(e))return{node:e,offset:s};let a=0;for(const l of e){const{length:e}=l.nodeValue;if(a+e>=s)return{node:l,offset:s-a};a+=e}},E=(e,t,r)=>{const{parentNode:i,id:n}=e,o=S(i,r),s=o.findIndex((t=>Array.isArray(t)?t.some((t=>t===e)):t===e)),a=o[s];if(Array.isArray(a)){let r=0;for(const i of a){if(i===e){r+=t;break}r+=i.nodeValue.length}t=r}const l={id:n,index:s,offset:t};return(i!==e.ownerDocument.documentElement?E(i,null,r).concat(l):[l]).filter((e=>-1!==e.index))},I=(e,t)=>x(e.documentElement,A(t)).node,T="urn:oasis:names:tc:opendocument:xmlns:container",L="http://www.w3.org/1999/xhtml",j="http://www.idpf.org/2007/opf",O="http://www.idpf.org/2007/ops",P="http://purl.org/dc/elements/1.1/",k="http://www.w3.org/2001/04/xmlenc#",N="http://www.daisy.org/z3986/2005/ncx/",B="http://www.w3.org/1999/xlink",R="http://www.w3.org/ns/SMIL",C={XML:"application/xml",NCX:"application/x-dtbncx+xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml",JS:/\/(x-)?(javascript|ecmascript)/},M=e=>e.toLowerCase().replace(/[-:](.)/g,((e,t)=>t.toUpperCase())),U=(e,t,r)=>r?r=>{var i,n;return null===(i=r.getAttribute(e))||void 0===i||null===(n=i.split(/\s/))||void 0===n?void 0:n.includes(t)}:"function"===typeof t?r=>t(r.getAttribute(e)):r=>r.getAttribute(e)===t,$=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>e?Object.fromEntries(t.map((t=>[M(t),e.getAttribute(t)]))):null},F=e=>{return(t=null===e||void 0===e?void 0:e.textContent)?t.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"";var t},H=(e,t)=>{const r=e.lookupNamespaceURI(null)===t||e.lookupPrefix(t),i=r?(e,r)=>e=>e.namespaceURI===t&&e.localName===r:(e,t)=>e=>e.localName===t;return{$:(e,t)=>[...e.children].find(i(e,t)),$$:(e,t)=>[...e.children].filter(i(e,t)),$$$:r?(e,r)=>[...e.getElementsByTagNameNS(t,r)]:(e,t)=>[...e.getElementsByTagName(t)]}},D=(e,t)=>{try{if(t.includes(":"))return new URL(e,t);const r="https://invalid.invalid/",i=new URL(e,r+t);return i.search="",decodeURI(i.href.replace(r,""))}catch(r){return console.warn(r),e}},q=e=>/^(?!blob)\w+:/i.test(e),X=async(e,t,r)=>{const i=[];e.replace(t,(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i.push(t),null}));const n=[];for(const o of i)n.push(await r(...o));return e.replace(t,(()=>n.shift()))},z=e=>e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),V={attrs:["dir","xml:lang"]},_={name:"alternate-script",many:!0,...V,props:["file-as"]},W={many:!0,...V,props:[{name:"role",many:!0,attrs:["scheme"]},"file-as",_],setLegacyAttrs:(e,t)=>{var r,i;if(null===(r=e.role)||void 0===r||!r.length){const r=t.getAttributeNS(j,"role");r&&(e.role=[{value:r}])}null!==(i=e.fileAs)&&void 0!==i||(e.fileAs=t.getAttributeNS(j,"file-as"))}},G=[{name:"title",many:!0,...V,props:["title-type","display-seq","file-as",_]},{name:"identifier",many:!0,props:[{name:"identifier-type",attrs:["scheme"]}],setLegacyAttrs:(e,t)=>{if(!e.identifierType){const r=t.getAttributeNS(j,"scheme");r&&(e.identifierType={value:r})}}},{name:"language",many:!0},{name:"creator",...W},{name:"contributor",...W},{name:"publisher",...V,props:["file-as",_]},{name:"description",...V,props:[_]},{name:"rights",...V,props:[_]},{name:"date"},{name:"dcterms:modified",type:"meta"},{name:"subject",many:!0,...V,props:["term","authority",_],setLegacyAttrs:(e,t)=>{var r,i;null!==(r=e.term)&&void 0!==r||(e.term=t.getAttributeNS(j,"term")),null!==(i=e.authority)&&void 0!==i||(e.authority=t.getAttributeNS(j,"authority"))}},{name:"source",many:!0},{name:"belongs-to-collection",type:"meta",many:!0,...V,props:["collection-type","group-position","dcterms:identifier","file-as",_,{name:"belongs-to-collection",recursive:!0}]}],J=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;const{$:r,$$:i,$$$:n}=H(e,L),o=e=>i=>{var n,o;const a=null!==(n=r(i,"a"))&&void 0!==n?n:r(i,"span"),l=r(i,"ol"),c=(e=>e?decodeURI(t(e)):null)(null===a||void 0===a?void 0:a.getAttribute("href")),d={label:F(a)||(null===a||void 0===a?void 0:a.getAttribute("title")),href:c,subitems:s(l)};return e&&(d.type=null===a||void 0===a||null===(o=a.getAttributeNS(O,"type"))||void 0===o?void 0:o.split(/\s/)),d},s=(e,t)=>e?i(e,"li").map(o(t)):null,a=(e,t)=>s(r(e,"ol"),t),l=n(e,"nav");let c=null,d=null,u=null,h=[];for(const A of l){var f,p,v,m,g;const e=null!==(f=null===(p=A.getAttributeNS(O,"type"))||void 0===p?void 0:p.split(/\s/))&&void 0!==f?f:[];e.includes("toc")?null!==(v=c)&&void 0!==v||(c=a(A)):e.includes("page-list")?null!==(m=d)&&void 0!==m||(d=a(A)):e.includes("landmarks")?null!==(g=u)&&void 0!==g||(u=a(A,!0)):h.push({label:F(A.firstElementChild),type:e,list:a(A)})}return{toc:c,pageList:d,landmarks:u,others:h}},K=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;const{$:r,$$:i}=H(e,N),n=e=>{const o=r(e,"navLabel"),s=r(e,"content"),a=F(o),l=(e=>e?decodeURI(t(e)):null)(s.getAttribute("src"));if("navPoint"===e.localName){const t=i(e,"navPoint");return{label:a,href:l,subitems:t.length?t.map(n):null}}return{label:a,href:l}},o=(e,t)=>i(e,t).map(n),s=(t,i)=>{const n=r(e.documentElement,t);return n?o(n,i):null};return{toc:s("navMap","navPoint"),pageList:s("pageList","pageTarget"),others:i(e.documentElement,"navList").map((e=>({label:F(r(e,"navLabel")),list:o(e,"navTarget")})))}},Q=e=>{if(!e)return;const t=e.split(":").map((e=>parseFloat(e)));if(3===t.length){const[e,r,i]=t;return 60*e*60+60*r+i}if(2===t.length){const[e,r]=t;return 60*e+r}const[r,i]=e.split(/(?=[^\d.])/);return parseFloat(r)*("h"===i?3600:"min"===i?60:"ms"===i?.001:1)};var Y=(0,n.A)("entries"),Z=(0,n.A)("lastMediaOverlayItem"),ee=(0,n.A)("sectionIndex"),te=(0,n.A)("audioIndex"),re=(0,n.A)("itemIndex"),ie=(0,n.A)("audio"),ne=(0,n.A)("volume"),oe=(0,n.A)("rate"),se=(0,n.A)("loadSMIL"),ae=(0,n.A)("activeAudio"),le=(0,n.A)("activeItem"),ce=(0,n.A)("error"),de=(0,n.A)("highlight"),ue=(0,n.A)("unhighlight"),he=(0,n.A)("play");class fe extends EventTarget{constructor(e,t){super(),Object.defineProperty(this,he,{value:be}),Object.defineProperty(this,ue,{value:ye}),Object.defineProperty(this,de,{value:Ae}),Object.defineProperty(this,ce,{value:ge}),Object.defineProperty(this,le,{get:me,set:void 0}),Object.defineProperty(this,ae,{get:ve,set:void 0}),Object.defineProperty(this,se,{value:pe}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),Object.defineProperty(this,Z,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:1}),Object.defineProperty(this,oe,{writable:!0,value:1}),this.book=e,this.loadXML=t}async start(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;null===(t=(0,i.A)(this,ie)[ie])||void 0===t||t.pause();const n=this.book.sections[e],o=null===n||void 0===n?void 0:n.id;if(!o)return;const{mediaOverlay:s}=n;if(!s)return this.start(e+1);(0,i.A)(this,ee)[ee]=e,await(0,i.A)(this,se)[se](s);for(let a=0;a<(0,i.A)(this,Y)[Y].length;a++){const{items:e}=(0,i.A)(this,Y)[Y][a];for(let t=0;t<e.length;t++)if(e[t].text.split("#")[0]===o&&r(e[t],t,e))return(0,i.A)(this,he)[he](a,t).catch((e=>(0,i.A)(this,ce)[ce](e)))}}pause(){var e;null===(e=(0,i.A)(this,ie)[ie])||void 0===e||e.pause()}resume(){var e;null===(e=(0,i.A)(this,ie)[ie])||void 0===e||e.play().catch((e=>(0,i.A)(this,ce)[ce](e)))}prev(){(0,i.A)(this,re)[re]>0?(0,i.A)(this,he)[he]((0,i.A)(this,te)[te],(0,i.A)(this,re)[re]-1):(0,i.A)(this,te)[te]>0?(0,i.A)(this,he)[he]((0,i.A)(this,te)[te]-1,(0,i.A)(this,Y)[Y][(0,i.A)(this,te)[te]-1].items.length-1):(0,i.A)(this,ee)[ee]>0&&this.start((0,i.A)(this,ee)[ee]-1,((e,t,r)=>t===r.length-1))}next(){(0,i.A)(this,he)[he]((0,i.A)(this,te)[te],(0,i.A)(this,re)[re]+1)}setVolume(e){(0,i.A)(this,ne)[ne]=e,(0,i.A)(this,ie)[ie]&&((0,i.A)(this,ie)[ie].volume=e)}setRate(e){(0,i.A)(this,oe)[oe]=e,(0,i.A)(this,ie)[ie]&&((0,i.A)(this,ie)[ie].playbackRate=e)}}async function pe(e){if((0,i.A)(this,Z)[Z]===e)return;const t=await this.loadXML(e.href),r=t=>t?D(t,e.href):null,{$:n,$$$:o}=H(t,R);(0,i.A)(this,te)[te]=-1,(0,i.A)(this,re)[re]=-1,(0,i.A)(this,Y)[Y]=o(t,"par").reduce(((e,t)=>{var i;const o=r(null===(i=n(t,"text"))||void 0===i?void 0:i.getAttribute("src")),s=n(t,"audio");if(!o||!s)return e;const a=r(s.getAttribute("src")),l=Q(s.getAttribute("clipBegin")),c=Q(s.getAttribute("clipEnd")),d=e.at(-1);return(null===d||void 0===d?void 0:d.src)===a?d.items.push({text:o,begin:l,end:c}):e.push({src:a,items:[{text:o,begin:l,end:c}]}),e}),[]),(0,i.A)(this,Z)[Z]=e}function ve(){return(0,i.A)(this,Y)[Y][(0,i.A)(this,te)[te]]}function me(){var e,t;return null===(e=(0,i.A)(this,ae)[ae])||void 0===e||null===(t=e.items)||void 0===t?void 0:t[(0,i.A)(this,re)[re]]}function ge(e){console.error(e),this.dispatchEvent(new CustomEvent("error",{detail:e}))}function Ae(){this.dispatchEvent(new CustomEvent("highlight",{detail:(0,i.A)(this,le)[le]}))}function ye(){this.dispatchEvent(new CustomEvent("unhighlight",{detail:(0,i.A)(this,le)[le]}))}async function be(e,t){var r;(0,i.A)(this,ie)[ie]&&((0,i.A)(this,ie)[ie].pause(),URL.revokeObjectURL((0,i.A)(this,ie)[ie].src),(0,i.A)(this,ie)[ie]=null),(0,i.A)(this,te)[te]=e,(0,i.A)(this,re)[re]=t;const n=null===(r=(0,i.A)(this,ae)[ae])||void 0===r?void 0:r.src;if(!n||!(0,i.A)(this,le)[le])return this.start((0,i.A)(this,ee)[ee]+1);const o=URL.createObjectURL(await this.book.loadBlob(n)),s=new Audio(o);(0,i.A)(this,ie)[ie]=s,s.addEventListener("timeupdate",(()=>{var e;if(s.paused)return;const t=s.currentTime,{items:r}=(0,i.A)(this,ae)[ae];if(t>(null===(e=(0,i.A)(this,le)[le])||void 0===e?void 0:e.end)&&((0,i.A)(this,ue)[ue](),(0,i.A)(this,re)[re]===r.length-1))return void(0,i.A)(this,he)[he]((0,i.A)(this,te)[te]+1,0).catch((e=>(0,i.A)(this,ce)[ce](e)));const n=(0,i.A)(this,re)[re];for(;(null===(o=r[(0,i.A)(this,re)[re]+1])||void 0===o?void 0:o.begin)<=t;){var o;(0,i.A)(this,re)[re]++}(0,i.A)(this,re)[re]!==n&&(0,i.A)(this,de)[de]()})),s.addEventListener("error",(()=>(0,i.A)(this,ce)[ce](new Error("Failed to load ".concat(n))))),s.addEventListener("playing",(()=>(0,i.A)(this,de)[de]())),s.addEventListener("pause",(()=>(0,i.A)(this,ue)[ue]())),s.addEventListener("ended",(()=>{(0,i.A)(this,ue)[ue](),URL.revokeObjectURL(o),(0,i.A)(this,ie)[ie]=null,(0,i.A)(this,he)[he](e+1,0).catch((e=>(0,i.A)(this,ce)[ce](e)))})),s.addEventListener("canplaythrough",(()=>{var e;s.currentTime=null!==(e=(0,i.A)(this,le)[le].begin)&&void 0!==e?e:0,s.volume=(0,i.A)(this,ne)[ne],s.playbackRate=(0,i.A)(this,oe)[oe],s.play().catch((e=>(0,i.A)(this,ce)[ce](e)))}))}const we=/([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/,Se=e=>{var t;return F(null!==(t=e.getElementById(e.documentElement.getAttribute("unique-identifier")))&&void 0!==t?t:e.getElementsByTagNameNS(P,"identifier")[0])},xe=async(e,t,r)=>{const i=new Uint8Array(await r.slice(0,t).arrayBuffer());t=Math.min(t,i.length);for(var n=0;n<t;n++)i[n]=i[n]^e[n%e.length];return new Blob([i,r.slice(t)],{type:r.type})},Ee=async e=>{const t=(new TextEncoder).encode(e),r=await globalThis.crypto.subtle.digest("SHA-1",t);return new Uint8Array(r)},Ie=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee;return{"http://www.idpf.org/2008/embedding":{key:t=>e(Se(t).replaceAll(/[\u0020\u0009\u000d\u000a]/g,"")),decode:(e,t)=>xe(e,1040,t)},"http://ns.adobe.com/pdf/enc#RC":{key:e=>{const t=(e=>{for(const t of e.getElementsByTagNameNS(P,"identifier")){const[e]=F(t).split(":").slice(-1);if(we.test(e))return e}return""})(e).replaceAll("-","");return Uint8Array.from({length:16},((e,r)=>parseInt(t.slice(2*r,2*r+2),16)))},decode:(e,t)=>xe(e,1024,t)}}};var Te=(0,n.A)("uris"),Le=(0,n.A)("decoders"),je=(0,n.A)("algorithms");class Oe{constructor(e){Object.defineProperty(this,Te,{writable:!0,value:new Map}),Object.defineProperty(this,Le,{writable:!0,value:new Map}),Object.defineProperty(this,je,{writable:!0,value:void 0}),(0,i.A)(this,je)[je]=e}async init(e,t){if(!e)return;const r=Array.from(e.getElementsByTagNameNS(k,"EncryptedData"),(e=>{var t,r;return{algorithm:null===(t=e.getElementsByTagNameNS(k,"EncryptionMethod")[0])||void 0===t?void 0:t.getAttribute("Algorithm"),uri:null===(r=e.getElementsByTagNameNS(k,"CipherReference")[0])||void 0===r?void 0:r.getAttribute("URI")}}));for(const{algorithm:n,uri:o}of r){if(!(0,i.A)(this,Le)[Le].has(n)){const e=(0,i.A)(this,je)[je][n];if(!e){console.warn("Unknown encryption algorithm");continue}const r=await e.key(t);(0,i.A)(this,Le)[Le].set(n,(t=>e.decode(r,t)))}(0,i.A)(this,Te)[Te].set(o,n)}}getDecoder(e){var t;return null!==(t=(0,i.A)(this,Le)[Le].get((0,i.A)(this,Te)[Te].get(e)))&&void 0!==t?t:e=>e}}class Pe{constructor(e){var t,r,i,n,o,s,a,l;let{opf:c,resolveHref:d}=e;this.opf=c;const{$:u,$$:h,$$$:f}=H(c,j),p=u(c.documentElement,"manifest"),v=u(c.documentElement,"spine"),m=h(v,"itemref");this.manifest=h(p,"item").map($("href","id","media-type","properties","media-overlay")).map((e=>{var t;return e.href=d(e.href),e.properties=null===(t=e.properties)||void 0===t?void 0:t.split(/\s/),e})),this.spine=m.map($("idref","id","linear","properties")).map((e=>{var t;return e.properties=null===(t=e.properties)||void 0===t?void 0:t.split(/\s/),e})),this.pageProgressionDirection=v.getAttribute("page-progression-direction"),this.navPath=null===(t=this.getItemByProperty("nav"))||void 0===t?void 0:t.href,this.ncxPath=null===(r=null!==(i=this.getItemByID(v.getAttribute("toc")))&&void 0!==i?i:this.manifest.find((e=>e.mediaType===C.NCX)))||void 0===r?void 0:r.href;const A=u(c.documentElement,"guide");A&&(this.guide=h(A,"reference").map($("type","title","href")).map((e=>{let{type:t,title:r,href:i}=e;return{label:r,type:t.split(/\s/),href:d(i)}}))),this.cover=null!==(n=null!==(o=this.getItemByProperty("cover-image"))&&void 0!==o?o:this.getItemByID(null===(s=f(c,"meta").find(U("name","cover")))||void 0===s?void 0:s.getAttribute("content")))&&void 0!==n?n:this.getItemByHref(null===(a=this.guide)||void 0===a||null===(l=a.find((e=>e.type.includes("cover"))))||void 0===l?void 0:l.href),this.cfis=(e=>{const t=[],{parentNode:r}=e[0],i=E(r);for(const[n,o]of S(r).entries()){const r=e[t.length];o===r&&t.push(g([i.concat({id:r.id,index:n})]))}return t})(m)}getItemByID(e){return this.manifest.find((t=>t.id===e))}getItemByHref(e){return this.manifest.find((t=>t.href===e))}getItemByProperty(e){return this.manifest.find((t=>{var r;return null===(r=t.properties)||void 0===r?void 0:r.includes(e)}))}resolveCFI(e){var t,r;const i=p(e),n=(null!==(t=i.parent)&&void 0!==t?t:i).shift();let o=I(this.opf,n);o&&"idref"!==o.nodeName&&(n.at(-1).id=null,o=I(this.opf,n));const s=null===(r=o)||void 0===r?void 0:r.getAttribute("idref");return{index:this.spine.findIndex((e=>e.idref===s)),anchor:e=>((e,t,r)=>{const i=A(t),n=A(t,!0),o=e.documentElement,s=x(o,i[0],r),a=x(o,n[0],r),l=e.createRange();return s.before?l.setStartBefore(s.node):s.after?l.setStartAfter(s.node):l.setStart(s.node,s.offset),a.before?l.setEndBefore(a.node):a.after?l.setEndAfter(a.node):l.setEnd(a.node,a.offset),l})(e,i)}}}var ke=(0,n.A)("cache"),Ne=(0,n.A)("children"),Be=(0,n.A)("refCount");class Re{constructor(e){let{loadText:t,loadBlob:r,resources:i}=e;Object.defineProperty(this,ke,{writable:!0,value:new Map}),Object.defineProperty(this,Ne,{writable:!0,value:new Map}),Object.defineProperty(this,Be,{writable:!0,value:new Map}),this.allowScript=!1,this.loadText=t,this.loadBlob=r,this.manifest=i.manifest,this.assets=i.manifest}createURL(e,t,r,n){if(!t)return"";const o=URL.createObjectURL(new Blob([t],{type:r}));if((0,i.A)(this,ke)[ke].set(e,o),(0,i.A)(this,Be)[Be].set(e,1),n){const t=(0,i.A)(this,Ne)[Ne].get(n);t?t.push(e):(0,i.A)(this,Ne)[Ne].set(n,[e])}return o}ref(e,t){const r=(0,i.A)(this,Ne)[Ne].get(t);return null!==r&&void 0!==r&&r.includes(e)||((0,i.A)(this,Be)[Be].set(e,(0,i.A)(this,Be)[Be].get(e)+1),r?r.push(e):(0,i.A)(this,Ne)[Ne].set(t,[e])),(0,i.A)(this,ke)[ke].get(e)}unref(e){if(!(0,i.A)(this,Be)[Be].has(e))return;const t=(0,i.A)(this,Be)[Be].get(e)-1;if(t<1){URL.revokeObjectURL((0,i.A)(this,ke)[ke].get(e)),(0,i.A)(this,ke)[ke].delete(e),(0,i.A)(this,Be)[Be].delete(e);const t=(0,i.A)(this,Ne)[Ne].get(e);if(t)for(;t.length;)this.unref(t.pop());(0,i.A)(this,Ne)[Ne].delete(e)}else(0,i.A)(this,Be)[Be].set(e,t)}async loadItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return null;const{href:r,mediaType:n}=e,o=C.JS.test(e.mediaType);if(o&&!this.allowScript)return null;const s=t.at(-1);if((0,i.A)(this,ke)[ke].has(r))return this.ref(r,s);return(o||[C.XHTML,C.HTML,C.CSS,C.SVG].includes(n))&&t.every((e=>e!==r))?this.loadReplaced(e,t):this.createURL(r,await this.loadBlob(r),n,s)}async loadHref(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(q(e))return e;const i=D(e,t),n=this.manifest.find((e=>e.href===i));return n?this.loadItem(n,r.concat(t)):e}async loadReplaced(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{href:r,mediaType:i}=e,n=t.at(-1),o=await this.loadText(r);if(!o)return null;if([C.XHTML,C.HTML,C.SVG].includes(i)){let s=(new DOMParser).parseFromString(o,i);if(i===C.XHTML&&s.querySelector("parsererror")&&(console.warn(s.querySelector("parsererror").innerText),e.mediaType=C.HTML,s=(new DOMParser).parseFromString(o,e.mediaType)),[C.XHTML,C.SVG].includes(e.mediaType)){let e=s.firstChild;for(;e instanceof ProcessingInstruction;){if(e.data){const i=await X(e.data,/(?:^|\s*)(href\s*=\s*['"])([^'"]*)(['"])/i,((e,i,n,o)=>this.loadHref(n,r,t).then((e=>"".concat(i).concat(e).concat(o)))));e.replaceWith(s.createProcessingInstruction(e.target,i))}e=e.nextSibling}}const a=async(e,i)=>e.setAttribute(i,await this.loadHref(e.getAttribute(i),r,t));for(const e of s.querySelectorAll("link[href]"))await a(e,"href");for(const e of s.querySelectorAll("[src]"))await a(e,"src");for(const e of s.querySelectorAll("[poster]"))await a(e,"poster");for(const e of s.querySelectorAll("object[data]"))await a(e,"data");for(const e of s.querySelectorAll("[*|href]:not([href]"))e.setAttributeNS(B,"href",await this.loadHref(e.getAttributeNS(B,"href"),r,t));for(const e of s.querySelectorAll("style"))e.textContent&&(e.textContent=await this.replaceCSS(e.textContent,r,t));for(const e of s.querySelectorAll("[style]"))e.setAttribute("style",await this.replaceCSS(e.getAttribute("style"),r,t));const l=(new XMLSerializer).serializeToString(s);return this.createURL(r,l,e.mediaType,n)}const s=i===C.CSS?await this.replaceCSS(o,r,t):await this.replaceString(o,r,t);return this.createURL(r,s,i,n)}async replaceCSS(e,t){var r,i,n,o;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const a=await X(e,/url\(\s*["']?([^'"\n]*?)\s*["']?\s*\)/gi,((e,r)=>this.loadHref(r,t,s).then((e=>'url("'.concat(e,'")'))))),l=await X(a,/@import\s*["']([^"'\n]*?)["']/gi,((e,r)=>this.loadHref(r,t,s).then((e=>'@import "'.concat(e,'"'))))),c=null!==(r=null===(i=window)||void 0===i?void 0:i.innerWidth)&&void 0!==r?r:800,d=null!==(n=null===(o=window)||void 0===o?void 0:o.innerHeight)&&void 0!==n?n:600;return l.replace(/(?<=[{\s;])-epub-/gi,"").replace(/(\d*\.?\d+)vw/gi,((e,t)=>parseFloat(t)*c/100+"px")).replace(/(\d*\.?\d+)vh/gi,((e,t)=>parseFloat(t)*d/100+"px")).replace(/page-break-(after|before|inside)\s*:/gi,((e,t)=>"-webkit-column-break-".concat(t,":"))).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,((e,t,r)=>"break-".concat(t,": ").concat(null!==r&&void 0!==r?r:"","column")))}replaceString(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const i=new Map,n=this.assets.map((e=>{if(e.href===t)return;const r=((e,t)=>{if(!e)return t;const r=e.replace(/\/$/,"").split("/"),i=t.replace(/\/$/,"").split("/"),n=(r.length>i.length?r:i).findIndex(((e,t)=>r[t]!==i[t]));return n<0?"":Array(r.length-n).fill("..").concat(i.slice(n)).join("/")})((e=>e.slice(0,e.lastIndexOf("/")+1))(t),e.href),n=encodeURI(r),o="/"+e.href,s=encodeURI(o),a=new Set([r,n,o,s]);for(const t of a)i.set(t,e);return Array.from(a)})).flat().filter((e=>e));if(!n.length)return e;const o=new RegExp(n.map(z).join("|"),"g");return X(e,o,(async e=>this.loadItem(i.get(e.replace(/^\//,"")),r.concat(t))))}unloadItem(e){this.unref(null===e||void 0===e?void 0:e.href)}destroy(){for(const e of(0,i.A)(this,ke)[ke].values())URL.revokeObjectURL(e)}}const Ce=e=>{for(const t of e){if("page-spread-left"===t||"rendition:page-spread-left"===t)return"left";if("page-spread-right"===t||"rendition:page-spread-right"===t)return"right";if("rendition:page-spread-center"===t)return"center"}};var Me=(0,n.A)("loader"),Ue=(0,n.A)("encryption"),$e=(0,n.A)("loadXML");class Fe{constructor(e){let{loadText:t,loadBlob:r,getSize:n,sha1:o}=e;Object.defineProperty(this,$e,{value:He}),this.parser=new DOMParser,Object.defineProperty(this,Me,{writable:!0,value:void 0}),Object.defineProperty(this,Ue,{writable:!0,value:void 0}),this.loadText=t,this.loadBlob=r,this.getSize=n,(0,i.A)(this,Ue)[Ue]=new Oe(Ie(o))}async init(){var e,t,r,n,o,s,a,l,c,d,u,h,f,p;const v=await(0,i.A)(this,$e)[$e]("META-INF/container.xml");if(!v)throw new Error("Failed to load container file");const m=Array.from(v.getElementsByTagNameNS(T,"rootfile"),$("full-path","media-type")).filter((e=>"application/oebps-package+xml"===e.mediaType));if(!m.length)throw new Error("No package document defined in container");const g=m[0].fullPath,A=await(0,i.A)(this,$e)[$e](g);if(!A)throw new Error("Failed to load package document");const y=await(0,i.A)(this,$e)[$e]("META-INF/encryption.xml");await(0,i.A)(this,Ue)[Ue].init(y,A),this.resources=new Pe({opf:A,resolveHref:e=>D(e,g)}),(0,i.A)(this,Me)[Me]=new Re({loadText:this.loadText,loadBlob:e=>Promise.resolve(this.loadBlob(e)).then((0,i.A)(this,Ue)[Ue].getDecoder(e)),resources:this.resources}),this.sections=this.resources.spine.map(((e,t)=>{const{idref:r,linear:n,properties:o=[]}=e,s=this.resources.getItemByID(r);return s?{id:s.href,load:()=>(0,i.A)(this,Me)[Me].loadItem(s),unload:()=>(0,i.A)(this,Me)[Me].unloadItem(s),createDocument:()=>this.loadDocument(s),size:this.getSize(s.href),cfi:this.resources.cfis[t],linear:n,pageSpread:Ce(o),resolveHref:e=>D(e,s.href),mediaOverlay:s.mediaOverlay?this.resources.getItemByID(s.mediaOverlay):null}:(console.warn('Could not find item with ID "'.concat(r,'" in manifest')),null)})).filter((e=>e));const{navPath:b,ncxPath:w}=this.resources;if(b)try{const e=e=>D(e,b),t=J(await(0,i.A)(this,$e)[$e](b),e);this.toc=t.toc,this.pageList=t.pageList,this.landmarks=t.landmarks}catch(k){console.warn(k)}if(!this.toc&&w)try{const e=e=>D(e,w),t=K(await(0,i.A)(this,$e)[$e](w),e);this.toc=t.toc,this.pageList=t.pageList}catch(k){console.warn(k)}null!==(e=this.landmarks)&&void 0!==e||(this.landmarks=this.resources.guide);const{metadata:S,rendition:x,media:E}=(e=>{const{$:t,$$:r}=H(e,j),i=t(e.documentElement,"metadata"),n=Array.from(i.children),o=(e,t)=>{var r;if(!t)return null;const{props:i=[],attrs:s=[]}=e,a=F(t);if(!i.length&&!s.length)return a;const l=t.getAttribute("id"),c=l?n.filter(U("refines","#"+l)):[],d=Object.fromEntries([["value",a]].concat(i.map((t=>{const{many:r,recursive:i}=t,n="string"===typeof t?t:t.name,s=U("property",n),a=i?e:t;return[M(n),r?c.filter(s).map((e=>o(a,e))):o(a,c.find(s))]}))).concat(s.map((e=>[M(e),t.getAttribute(e)]))));return null===(r=e.setLegacyAttrs)||void 0===r||r.call(e,d,t),d},s=n.filter(U("refines",null)),a=Object.fromEntries(G.map((e=>{const{type:t,name:r,many:i}=e,n="meta"===t?e=>e.namespaceURI===j&&e.getAttribute("property")===r:e=>e.namespaceURI===P&&e.localName===r;return[M(r),i?s.filter(n).map((t=>o(e,t))):o(e,s.find(n))]}))),l=r(i,"meta"),c=e=>l.filter(U("property",(t=>null===t||void 0===t?void 0:t.startsWith(e)))).map((t=>[t.getAttribute("property").replace(e,""),t])),d=Object.fromEntries(c("rendition:").map((e=>{let[t,r]=e;return[t,F(r)]}))),u={narrator:[],duration:{}};for(const[v,m]of c("media:")){var h,f,p;const e=F(m);"duration"===v?u.duration[null!==(h=null===(f=m.getAttribute("refines"))||void 0===f||null===(p=f.split("#"))||void 0===p?void 0:p[1])&&void 0!==h?h:""]=Q(e):"active-class"===v?u.activeClass=e:"narrator"===v?u.narrator.push(e):"playback-active-class"===v&&(u.playbackActiveClass=e)}return{metadata:a,rendition:d,media:u}})(A);this.rendition=x,this.media=E,this.dir=this.resources.pageProgressionDirection,this.parsedMetadata=S;const I=null===S||void 0===S||null===(t=S.title)||void 0===t?void 0:t[0];this.metadata={title:null===I||void 0===I?void 0:I.value,subtitle:null===S||void 0===S||null===(r=S.title)||void 0===r||null===(n=r.find((e=>"subtitle"===e.titleType)))||void 0===n?void 0:n.value,sortAs:null===I||void 0===I?void 0:I.fileAs,language:null===S||void 0===S?void 0:S.language,identifier:Se(A),description:null===S||void 0===S||null===(o=S.description)||void 0===o?void 0:o.value,publisher:null===S||void 0===S||null===(s=S.publisher)||void 0===s?void 0:s.value,published:null===S||void 0===S?void 0:S.date,modified:null===S||void 0===S?void 0:S.dctermsModified,subject:null===S||void 0===S||null===(a=S.subject)||void 0===a||null===(l=a.filter((e=>{let{value:t,term:r}=e;return t||r})))||void 0===l?void 0:l.map((e=>{let{value:t,term:r,authority:i}=e;return{name:t,code:r,scheme:i}})),rights:null===S||void 0===S||null===(c=S.rights)||void 0===c?void 0:c.value};const L={art:"artist",aut:"author",bkp:"producer",clr:"colorist",edt:"editor",ill:"illustrator",nrt:"narrator",trl:"translator",pbl:"publisher"},O=e=>t=>{var r;const i=[...new Set(null===(r=t.role)||void 0===r?void 0:r.map((t=>{var r;let{value:i,scheme:n}=t;return null!==(r=n&&"marc:relators"!==n?null:L[i])&&void 0!==r?r:e})))],n={name:t.value,sortAs:t.fileAs};return[null!==i&&void 0!==i&&i.length?i:[e],n]};return null===S||void 0===S||null===(d=S.creator)||void 0===d||null===(u=d.map(O("author")))||void 0===u||null===(h=u.concat(null===S||void 0===S||null===(f=S.contributor)||void 0===f||null===(p=f.map)||void 0===p?void 0:p.call(f,O("contributor"))))||void 0===h||h.forEach((e=>{let[t,r]=e;return t.forEach((e=>{this.metadata[e]?this.metadata[e].push(r):this.metadata[e]=[r]}))})),this}async loadDocument(e){const t=await this.loadText(e.href);return this.parser.parseFromString(t,e.mediaType)}getMediaOverlay(){return new fe(this,(0,i.A)(this,$e)[$e].bind(this))}resolveCFI(e){return this.resources.resolveCFI(e)}resolveHref(e){const[t,r]=e.split("#"),i=this.resources.getItemByHref(decodeURI(t));if(!i)return null;return{index:this.resources.spine.findIndex((e=>{let{idref:t}=e;return t===i.id})),anchor:r?e=>((e,t)=>{var r;return null!==(r=e.getElementById(t))&&void 0!==r?r:e.querySelector('[name="'.concat(CSS.escape(t),'"]'))})(e,r):()=>0}}splitTOCHref(e){var t;return null!==(t=null===e||void 0===e?void 0:e.split("#"))&&void 0!==t?t:[]}getTOCFragment(e,t){var r;return null!==(r=e.getElementById(t))&&void 0!==r?r:e.querySelector('[name="'.concat(CSS.escape(t),'"]'))}isExternal(e){return q(e)}async getCover(){var e;const t=null===(e=this.resources)||void 0===e?void 0:e.cover;return null!==t&&void 0!==t&&t.href?new Blob([await this.loadBlob(t.href)],{type:t.mediaType}):null}async getCalibreBookmarks(){const e=await this.loadText("META-INF/calibre_bookmarks.txt"),t="encoding=json+base64:";if(null!==e&&void 0!==e&&e.startsWith(t)){const t=atob(e.slice(21));return JSON.parse(t)}}destroy(){var e;null===(e=(0,i.A)(this,Me)[Me])||void 0===e||e.destroy()}}async function He(e){const t=await this.loadText(e);if(!t)return null;const r=this.parser.parseFromString(t,C.XML);if(r.querySelector("parsererror"))throw new Error("XML parsing error: ".concat(e,"\n").concat(r.querySelector("parsererror").innerText));return r}}}]);
//# sourceMappingURL=896.a8ac5f3d.chunk.js.map