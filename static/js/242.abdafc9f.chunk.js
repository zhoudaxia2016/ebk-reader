"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[242],{242:(e,t,i)=>{i.d(t,{EPUB:()=>ye});var r=i(473),n=i(341),s=i(752);const o="urn:oasis:names:tc:opendocument:xmlns:container",a="http://www.w3.org/1999/xhtml",l="http://www.idpf.org/2007/opf",c="http://www.idpf.org/2007/ops",d="http://purl.org/dc/elements/1.1/",u="http://www.w3.org/2001/04/xmlenc#",h="http://www.daisy.org/z3986/2005/ncx/",p="http://www.w3.org/1999/xlink",f="http://www.w3.org/ns/SMIL",v={XML:"application/xml",NCX:"application/x-dtbncx+xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml",JS:/\/(x-)?(javascript|ecmascript)/},m=e=>e.toLowerCase().replace(/[-:](.)/g,((e,t)=>t.toUpperCase())),g=(e,t,i)=>i?i=>{var r,n;return null===(r=i.getAttribute(e))||void 0===r||null===(n=r.split(/\s/))||void 0===n?void 0:n.includes(t)}:"function"===typeof t?i=>t(i.getAttribute(e)):i=>i.getAttribute(e)===t,A=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return e=>e?Object.fromEntries(t.map((t=>[m(t),e.getAttribute(t)]))):null},y=e=>{return(t=null===e||void 0===e?void 0:e.textContent)?t.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"";var t},b=(e,t)=>{const i=e.lookupNamespaceURI(null)===t||e.lookupPrefix(t),r=i?(e,i)=>e=>e.namespaceURI===t&&e.localName===i:(e,t)=>e=>e.localName===t;return{$:(e,t)=>[...e.children].find(r(e,t)),$$:(e,t)=>[...e.children].filter(r(e,t)),$$$:i?(e,i)=>[...e.getElementsByTagNameNS(t,i)]:(e,t)=>[...e.getElementsByTagName(t)]}},w=(e,t)=>{try{if(t.includes(":"))return new URL(e,t);const i="https://invalid.invalid/",r=new URL(e,i+t);return r.search="",decodeURI(r.href.replace(i,""))}catch(i){return console.warn(i),e}},S=e=>/^(?!blob)\w+:/i.test(e),x=async(e,t,i)=>{const r=[];e.replace(t,(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.push(t),null}));const n=[];for(const s of r)n.push(await i(...s));return e.replace(t,(()=>n.shift()))},T=e=>e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),I={attrs:["dir","xml:lang"]},L={name:"alternate-script",many:!0,...I,props:["file-as"]},E={many:!0,...I,props:[{name:"role",many:!0,attrs:["scheme"]},"file-as",L],setLegacyAttrs:(e,t)=>{var i,r;if(null===(i=e.role)||void 0===i||!i.length){const i=t.getAttributeNS(l,"role");i&&(e.role=[{value:i}])}null!==(r=e.fileAs)&&void 0!==r||(e.fileAs=t.getAttributeNS(l,"file-as"))}},O=[{name:"title",many:!0,...I,props:["title-type","display-seq","file-as",L]},{name:"identifier",many:!0,props:[{name:"identifier-type",attrs:["scheme"]}],setLegacyAttrs:(e,t)=>{if(!e.identifierType){const i=t.getAttributeNS(l,"scheme");i&&(e.identifierType={value:i})}}},{name:"language",many:!0},{name:"creator",...E},{name:"contributor",...E},{name:"publisher",...I,props:["file-as",L]},{name:"description",...I,props:[L]},{name:"rights",...I,props:[L]},{name:"date"},{name:"dcterms:modified",type:"meta"},{name:"subject",many:!0,...I,props:["term","authority",L],setLegacyAttrs:(e,t)=>{var i,r;null!==(i=e.term)&&void 0!==i||(e.term=t.getAttributeNS(l,"term")),null!==(r=e.authority)&&void 0!==r||(e.authority=t.getAttributeNS(l,"authority"))}},{name:"source",many:!0},{name:"belongs-to-collection",type:"meta",many:!0,...I,props:["collection-type","group-position","dcterms:identifier","file-as",L,{name:"belongs-to-collection",recursive:!0}]}],P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;const{$:i,$$:r,$$$:n}=b(e,a),s=e=>r=>{var n,s;const a=null!==(n=i(r,"a"))&&void 0!==n?n:i(r,"span"),l=i(r,"ol"),d=(e=>e?decodeURI(t(e)):null)(null===a||void 0===a?void 0:a.getAttribute("href")),u={label:y(a)||(null===a||void 0===a?void 0:a.getAttribute("title")),href:d,subitems:o(l)};return e&&(u.type=null===a||void 0===a||null===(s=a.getAttributeNS(c,"type"))||void 0===s?void 0:s.split(/\s/)),u},o=(e,t)=>e?r(e,"li").map(s(t)):null,l=(e,t)=>o(i(e,"ol"),t),d=n(e,"nav");let u=null,h=null,p=null,f=[];for(const a of d){var v,m,g,A,w;const e=null!==(v=null===(m=a.getAttributeNS(c,"type"))||void 0===m?void 0:m.split(/\s/))&&void 0!==v?v:[];e.includes("toc")?null!==(g=u)&&void 0!==g||(u=l(a)):e.includes("page-list")?null!==(A=h)&&void 0!==A||(h=l(a)):e.includes("landmarks")?null!==(w=p)&&void 0!==w||(p=l(a,!0)):f.push({label:y(a.firstElementChild),type:e,list:l(a)})}return{toc:u,pageList:h,landmarks:p,others:f}},j=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;const{$:i,$$:r}=b(e,h),n=e=>{const s=i(e,"navLabel"),o=i(e,"content"),a=y(s),l=(e=>e?decodeURI(t(e)):null)(o.getAttribute("src"));if("navPoint"===e.localName){const t=r(e,"navPoint");return{label:a,href:l,subitems:t.length?t.map(n):null}}return{label:a,href:l}},s=(e,t)=>r(e,t).map(n),o=(t,r)=>{const n=i(e.documentElement,t);return n?s(n,r):null};return{toc:o("navMap","navPoint"),pageList:o("pageList","pageTarget"),others:r(e.documentElement,"navList").map((e=>({label:y(i(e,"navLabel")),list:s(e,"navTarget")})))}},k=e=>{if(!e)return;const t=e.split(":").map((e=>parseFloat(e)));if(3===t.length){const[e,i,r]=t;return 60*e*60+60*i+r}if(2===t.length){const[e,i]=t;return 60*e+i}const[i,r]=e.split(/(?=[^\d.])/);return parseFloat(i)*("h"===r?3600:"min"===r?60:"ms"===r?.001:1)};var B=(0,n.A)("entries"),C=(0,n.A)("lastMediaOverlayItem"),M=(0,n.A)("sectionIndex"),N=(0,n.A)("audioIndex"),R=(0,n.A)("itemIndex"),U=(0,n.A)("audio"),$=(0,n.A)("volume"),H=(0,n.A)("rate"),F=(0,n.A)("loadSMIL"),D=(0,n.A)("activeAudio"),q=(0,n.A)("activeItem"),X=(0,n.A)("error"),z=(0,n.A)("highlight"),V=(0,n.A)("unhighlight"),G=(0,n.A)("play");class W extends EventTarget{constructor(e,t){super(),Object.defineProperty(this,G,{value:ee}),Object.defineProperty(this,V,{value:Z}),Object.defineProperty(this,z,{value:Y}),Object.defineProperty(this,X,{value:Q}),Object.defineProperty(this,q,{get:K,set:void 0}),Object.defineProperty(this,D,{get:_,set:void 0}),Object.defineProperty(this,F,{value:J}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,C,{writable:!0,value:void 0}),Object.defineProperty(this,M,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,R,{writable:!0,value:void 0}),Object.defineProperty(this,U,{writable:!0,value:void 0}),Object.defineProperty(this,$,{writable:!0,value:1}),Object.defineProperty(this,H,{writable:!0,value:1}),this.book=e,this.loadXML=t}async start(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;null===(t=(0,r.A)(this,U)[U])||void 0===t||t.pause();const n=this.book.sections[e],s=null===n||void 0===n?void 0:n.id;if(!s)return;const{mediaOverlay:o}=n;if(!o)return this.start(e+1);(0,r.A)(this,M)[M]=e,await(0,r.A)(this,F)[F](o);for(let a=0;a<(0,r.A)(this,B)[B].length;a++){const{items:e}=(0,r.A)(this,B)[B][a];for(let t=0;t<e.length;t++)if(e[t].text.split("#")[0]===s&&i(e[t],t,e))return(0,r.A)(this,G)[G](a,t).catch((e=>(0,r.A)(this,X)[X](e)))}}pause(){var e;null===(e=(0,r.A)(this,U)[U])||void 0===e||e.pause()}resume(){var e;null===(e=(0,r.A)(this,U)[U])||void 0===e||e.play().catch((e=>(0,r.A)(this,X)[X](e)))}prev(){(0,r.A)(this,R)[R]>0?(0,r.A)(this,G)[G]((0,r.A)(this,N)[N],(0,r.A)(this,R)[R]-1):(0,r.A)(this,N)[N]>0?(0,r.A)(this,G)[G]((0,r.A)(this,N)[N]-1,(0,r.A)(this,B)[B][(0,r.A)(this,N)[N]-1].items.length-1):(0,r.A)(this,M)[M]>0&&this.start((0,r.A)(this,M)[M]-1,((e,t,i)=>t===i.length-1))}next(){(0,r.A)(this,G)[G]((0,r.A)(this,N)[N],(0,r.A)(this,R)[R]+1)}setVolume(e){(0,r.A)(this,$)[$]=e,(0,r.A)(this,U)[U]&&((0,r.A)(this,U)[U].volume=e)}setRate(e){(0,r.A)(this,H)[H]=e,(0,r.A)(this,U)[U]&&((0,r.A)(this,U)[U].playbackRate=e)}}async function J(e){if((0,r.A)(this,C)[C]===e)return;const t=await this.loadXML(e.href),i=t=>t?w(t,e.href):null,{$:n,$$$:s}=b(t,f);(0,r.A)(this,N)[N]=-1,(0,r.A)(this,R)[R]=-1,(0,r.A)(this,B)[B]=s(t,"par").reduce(((e,t)=>{var r;const s=i(null===(r=n(t,"text"))||void 0===r?void 0:r.getAttribute("src")),o=n(t,"audio");if(!s||!o)return e;const a=i(o.getAttribute("src")),l=k(o.getAttribute("clipBegin")),c=k(o.getAttribute("clipEnd")),d=e.at(-1);return(null===d||void 0===d?void 0:d.src)===a?d.items.push({text:s,begin:l,end:c}):e.push({src:a,items:[{text:s,begin:l,end:c}]}),e}),[]),(0,r.A)(this,C)[C]=e}function _(){return(0,r.A)(this,B)[B][(0,r.A)(this,N)[N]]}function K(){var e,t;return null===(e=(0,r.A)(this,D)[D])||void 0===e||null===(t=e.items)||void 0===t?void 0:t[(0,r.A)(this,R)[R]]}function Q(e){console.error(e),this.dispatchEvent(new CustomEvent("error",{detail:e}))}function Y(){this.dispatchEvent(new CustomEvent("highlight",{detail:(0,r.A)(this,q)[q]}))}function Z(){this.dispatchEvent(new CustomEvent("unhighlight",{detail:(0,r.A)(this,q)[q]}))}async function ee(e,t){var i;(0,r.A)(this,U)[U]&&((0,r.A)(this,U)[U].pause(),URL.revokeObjectURL((0,r.A)(this,U)[U].src),(0,r.A)(this,U)[U]=null),(0,r.A)(this,N)[N]=e,(0,r.A)(this,R)[R]=t;const n=null===(i=(0,r.A)(this,D)[D])||void 0===i?void 0:i.src;if(!n||!(0,r.A)(this,q)[q])return this.start((0,r.A)(this,M)[M]+1);const s=URL.createObjectURL(await this.book.loadBlob(n)),o=new Audio(s);(0,r.A)(this,U)[U]=o,o.addEventListener("timeupdate",(()=>{var e;if(o.paused)return;const t=o.currentTime,{items:i}=(0,r.A)(this,D)[D];if(t>(null===(e=(0,r.A)(this,q)[q])||void 0===e?void 0:e.end)&&((0,r.A)(this,V)[V](),(0,r.A)(this,R)[R]===i.length-1))return void(0,r.A)(this,G)[G]((0,r.A)(this,N)[N]+1,0).catch((e=>(0,r.A)(this,X)[X](e)));const n=(0,r.A)(this,R)[R];for(;(null===(s=i[(0,r.A)(this,R)[R]+1])||void 0===s?void 0:s.begin)<=t;){var s;(0,r.A)(this,R)[R]++}(0,r.A)(this,R)[R]!==n&&(0,r.A)(this,z)[z]()})),o.addEventListener("error",(()=>(0,r.A)(this,X)[X](new Error("Failed to load ".concat(n))))),o.addEventListener("playing",(()=>(0,r.A)(this,z)[z]())),o.addEventListener("pause",(()=>(0,r.A)(this,V)[V]())),o.addEventListener("ended",(()=>{(0,r.A)(this,V)[V](),URL.revokeObjectURL(s),(0,r.A)(this,U)[U]=null,(0,r.A)(this,G)[G](e+1,0).catch((e=>(0,r.A)(this,X)[X](e)))})),o.addEventListener("canplaythrough",(()=>{var e;o.currentTime=null!==(e=(0,r.A)(this,q)[q].begin)&&void 0!==e?e:0,o.volume=(0,r.A)(this,$)[$],o.playbackRate=(0,r.A)(this,H)[H],o.play().catch((e=>(0,r.A)(this,X)[X](e)))}))}const te=/([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/,ie=e=>{var t;return y(null!==(t=e.getElementById(e.documentElement.getAttribute("unique-identifier")))&&void 0!==t?t:e.getElementsByTagNameNS(d,"identifier")[0])},re=async(e,t,i)=>{const r=new Uint8Array(await i.slice(0,t).arrayBuffer());t=Math.min(t,r.length);for(var n=0;n<t;n++)r[n]=r[n]^e[n%e.length];return new Blob([r,i.slice(t)],{type:i.type})},ne=async e=>{const t=(new TextEncoder).encode(e),i=await globalThis.crypto.subtle.digest("SHA-1",t);return new Uint8Array(i)},se=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne;return{"http://www.idpf.org/2008/embedding":{key:t=>e(ie(t).replaceAll(/[\u0020\u0009\u000d\u000a]/g,"")),decode:(e,t)=>re(e,1040,t)},"http://ns.adobe.com/pdf/enc#RC":{key:e=>{const t=(e=>{for(const t of e.getElementsByTagNameNS(d,"identifier")){const[e]=y(t).split(":").slice(-1);if(te.test(e))return e}return""})(e).replaceAll("-","");return Uint8Array.from({length:16},((e,i)=>parseInt(t.slice(2*i,2*i+2),16)))},decode:(e,t)=>re(e,1024,t)}}};var oe=(0,n.A)("uris"),ae=(0,n.A)("decoders"),le=(0,n.A)("algorithms");class ce{constructor(e){Object.defineProperty(this,oe,{writable:!0,value:new Map}),Object.defineProperty(this,ae,{writable:!0,value:new Map}),Object.defineProperty(this,le,{writable:!0,value:void 0}),(0,r.A)(this,le)[le]=e}async init(e,t){if(!e)return;const i=Array.from(e.getElementsByTagNameNS(u,"EncryptedData"),(e=>{var t,i;return{algorithm:null===(t=e.getElementsByTagNameNS(u,"EncryptionMethod")[0])||void 0===t?void 0:t.getAttribute("Algorithm"),uri:null===(i=e.getElementsByTagNameNS(u,"CipherReference")[0])||void 0===i?void 0:i.getAttribute("URI")}}));for(const{algorithm:n,uri:s}of i){if(!(0,r.A)(this,ae)[ae].has(n)){const e=(0,r.A)(this,le)[le][n];if(!e){console.warn("Unknown encryption algorithm");continue}const i=await e.key(t);(0,r.A)(this,ae)[ae].set(n,(t=>e.decode(i,t)))}(0,r.A)(this,oe)[oe].set(s,n)}}getDecoder(e){var t;return null!==(t=(0,r.A)(this,ae)[ae].get((0,r.A)(this,oe)[oe].get(e)))&&void 0!==t?t:e=>e}}class de{constructor(e){var t,i,r,n,o,a,c,d;let{opf:u,resolveHref:h}=e;this.opf=u;const{$:p,$$:f,$$$:m}=b(u,l),y=p(u.documentElement,"manifest"),w=p(u.documentElement,"spine"),S=f(w,"itemref");this.manifest=f(y,"item").map(A("href","id","media-type","properties","media-overlay")).map((e=>{var t;return e.href=h(e.href),e.properties=null===(t=e.properties)||void 0===t?void 0:t.split(/\s/),e})),this.spine=S.map(A("idref","id","linear","properties")).map((e=>{var t;return e.properties=null===(t=e.properties)||void 0===t?void 0:t.split(/\s/),e})),this.pageProgressionDirection=w.getAttribute("page-progression-direction"),this.navPath=null===(t=this.getItemByProperty("nav"))||void 0===t?void 0:t.href,this.ncxPath=null===(i=null!==(r=this.getItemByID(w.getAttribute("toc")))&&void 0!==r?r:this.manifest.find((e=>e.mediaType===v.NCX)))||void 0===i?void 0:i.href;const x=p(u.documentElement,"guide");x&&(this.guide=f(x,"reference").map(A("type","title","href")).map((e=>{let{type:t,title:i,href:r}=e;return{label:i,type:t.split(/\s/),href:h(r)}}))),this.cover=null!==(n=null!==(o=this.getItemByProperty("cover-image"))&&void 0!==o?o:this.getItemByID(null===(a=m(u,"meta").find(g("name","cover")))||void 0===a?void 0:a.getAttribute("content")))&&void 0!==n?n:this.getItemByHref(null===(c=this.guide)||void 0===c||null===(d=c.find((e=>e.type.includes("cover"))))||void 0===d?void 0:d.href),this.cfis=s.ob(S)}getItemByID(e){return this.manifest.find((t=>t.id===e))}getItemByHref(e){return this.manifest.find((t=>t.href===e))}getItemByProperty(e){return this.manifest.find((t=>{var i;return null===(i=t.properties)||void 0===i?void 0:i.includes(e)}))}resolveCFI(e){var t,i;const r=s.qg(e),n=(null!==(t=r.parent)&&void 0!==t?t:r).shift();let o=s.wT(this.opf,n);o&&"idref"!==o.nodeName&&(n.at(-1).id=null,o=s.wT(this.opf,n));const a=null===(i=o)||void 0===i?void 0:i.getAttribute("idref");return{index:this.spine.findIndex((e=>e.idref===a)),anchor:e=>s.Xp(e,r)}}}var ue=(0,n.A)("cache"),he=(0,n.A)("children"),pe=(0,n.A)("refCount");class fe{constructor(e){let{loadText:t,loadBlob:i,resources:r}=e;Object.defineProperty(this,ue,{writable:!0,value:new Map}),Object.defineProperty(this,he,{writable:!0,value:new Map}),Object.defineProperty(this,pe,{writable:!0,value:new Map}),this.allowScript=!1,this.loadText=t,this.loadBlob=i,this.manifest=r.manifest,this.assets=r.manifest}createURL(e,t,i,n){if(!t)return"";const s=URL.createObjectURL(new Blob([t],{type:i}));if((0,r.A)(this,ue)[ue].set(e,s),(0,r.A)(this,pe)[pe].set(e,1),n){const t=(0,r.A)(this,he)[he].get(n);t?t.push(e):(0,r.A)(this,he)[he].set(n,[e])}return s}ref(e,t){const i=(0,r.A)(this,he)[he].get(t);return null!==i&&void 0!==i&&i.includes(e)||((0,r.A)(this,pe)[pe].set(e,(0,r.A)(this,pe)[pe].get(e)+1),i?i.push(e):(0,r.A)(this,he)[he].set(t,[e])),(0,r.A)(this,ue)[ue].get(e)}unref(e){if(!(0,r.A)(this,pe)[pe].has(e))return;const t=(0,r.A)(this,pe)[pe].get(e)-1;if(t<1){URL.revokeObjectURL((0,r.A)(this,ue)[ue].get(e)),(0,r.A)(this,ue)[ue].delete(e),(0,r.A)(this,pe)[pe].delete(e);const t=(0,r.A)(this,he)[he].get(e);if(t)for(;t.length;)this.unref(t.pop());(0,r.A)(this,he)[he].delete(e)}else(0,r.A)(this,pe)[pe].set(e,t)}async loadItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return null;const{href:i,mediaType:n}=e,s=v.JS.test(e.mediaType);if(s&&!this.allowScript)return null;const o=t.at(-1);if((0,r.A)(this,ue)[ue].has(i))return this.ref(i,o);return(s||[v.XHTML,v.HTML,v.CSS,v.SVG].includes(n))&&t.every((e=>e!==i))?this.loadReplaced(e,t):this.createURL(i,await this.loadBlob(i),n,o)}async loadHref(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(S(e))return e;const r=w(e,t),n=this.manifest.find((e=>e.href===r));return n?this.loadItem(n,i.concat(t)):e}async loadReplaced(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{href:i,mediaType:r}=e,n=t.at(-1),s=await this.loadText(i);if(!s)return null;if([v.XHTML,v.HTML,v.SVG].includes(r)){let o=(new DOMParser).parseFromString(s,r);if(r===v.XHTML&&o.querySelector("parsererror")&&(console.warn(o.querySelector("parsererror").innerText),e.mediaType=v.HTML,o=(new DOMParser).parseFromString(s,e.mediaType)),[v.XHTML,v.SVG].includes(e.mediaType)){let e=o.firstChild;for(;e instanceof ProcessingInstruction;){if(e.data){const r=await x(e.data,/(?:^|\s*)(href\s*=\s*['"])([^'"]*)(['"])/i,((e,r,n,s)=>this.loadHref(n,i,t).then((e=>"".concat(r).concat(e).concat(s)))));e.replaceWith(o.createProcessingInstruction(e.target,r))}e=e.nextSibling}}const a=async(e,r)=>e.setAttribute(r,await this.loadHref(e.getAttribute(r),i,t));for(const e of o.querySelectorAll("link[href]"))await a(e,"href");for(const e of o.querySelectorAll("[src]"))await a(e,"src");for(const e of o.querySelectorAll("[poster]"))await a(e,"poster");for(const e of o.querySelectorAll("object[data]"))await a(e,"data");for(const e of o.querySelectorAll("[*|href]:not([href]"))e.setAttributeNS(p,"href",await this.loadHref(e.getAttributeNS(p,"href"),i,t));for(const e of o.querySelectorAll("style"))e.textContent&&(e.textContent=await this.replaceCSS(e.textContent,i,t));for(const e of o.querySelectorAll("[style]"))e.setAttribute("style",await this.replaceCSS(e.getAttribute("style"),i,t));const l=(new XMLSerializer).serializeToString(o);return this.createURL(i,l,e.mediaType,n)}const o=r===v.CSS?await this.replaceCSS(s,i,t):await this.replaceString(s,i,t);return this.createURL(i,o,r,n)}async replaceCSS(e,t){var i,r,n,s;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const a=await x(e,/url\(\s*["']?([^'"\n]*?)\s*["']?\s*\)/gi,((e,i)=>this.loadHref(i,t,o).then((e=>'url("'.concat(e,'")'))))),l=await x(a,/@import\s*["']([^"'\n]*?)["']/gi,((e,i)=>this.loadHref(i,t,o).then((e=>'@import "'.concat(e,'"'))))),c=null!==(i=null===(r=window)||void 0===r?void 0:r.innerWidth)&&void 0!==i?i:800,d=null!==(n=null===(s=window)||void 0===s?void 0:s.innerHeight)&&void 0!==n?n:600;return l.replace(/(?<=[{\s;])-epub-/gi,"").replace(/(\d*\.?\d+)vw/gi,((e,t)=>parseFloat(t)*c/100+"px")).replace(/(\d*\.?\d+)vh/gi,((e,t)=>parseFloat(t)*d/100+"px")).replace(/page-break-(after|before|inside)\s*:/gi,((e,t)=>"-webkit-column-break-".concat(t,":"))).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,((e,t,i)=>"break-".concat(t,": ").concat(null!==i&&void 0!==i?i:"","column")))}replaceString(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=new Map,n=this.assets.map((e=>{if(e.href===t)return;const i=((e,t)=>{if(!e)return t;const i=e.replace(/\/$/,"").split("/"),r=t.replace(/\/$/,"").split("/"),n=(i.length>r.length?i:r).findIndex(((e,t)=>i[t]!==r[t]));return n<0?"":Array(i.length-n).fill("..").concat(r.slice(n)).join("/")})((e=>e.slice(0,e.lastIndexOf("/")+1))(t),e.href),n=encodeURI(i),s="/"+e.href,o=encodeURI(s),a=new Set([i,n,s,o]);for(const t of a)r.set(t,e);return Array.from(a)})).flat().filter((e=>e));if(!n.length)return e;const s=new RegExp(n.map(T).join("|"),"g");return x(e,s,(async e=>this.loadItem(r.get(e.replace(/^\//,"")),i.concat(t))))}unloadItem(e){this.unref(null===e||void 0===e?void 0:e.href)}destroy(){for(const e of(0,r.A)(this,ue)[ue].values())URL.revokeObjectURL(e)}}const ve=e=>{for(const t of e){if("page-spread-left"===t||"rendition:page-spread-left"===t)return"left";if("page-spread-right"===t||"rendition:page-spread-right"===t)return"right";if("rendition:page-spread-center"===t)return"center"}};var me=(0,n.A)("loader"),ge=(0,n.A)("encryption"),Ae=(0,n.A)("loadXML");class ye{constructor(e){let{loadText:t,loadBlob:i,getSize:n,sha1:s}=e;Object.defineProperty(this,Ae,{value:be}),this.parser=new DOMParser,Object.defineProperty(this,me,{writable:!0,value:void 0}),Object.defineProperty(this,ge,{writable:!0,value:void 0}),this.loadText=t,this.loadBlob=i,this.getSize=n,(0,r.A)(this,ge)[ge]=new ce(se(s))}async init(){var e,t,i,n,s,a,c,u,h,p,f,v,S,x;const T=await(0,r.A)(this,Ae)[Ae]("META-INF/container.xml");if(!T)throw new Error("Failed to load container file");const I=Array.from(T.getElementsByTagNameNS(o,"rootfile"),A("full-path","media-type")).filter((e=>"application/oebps-package+xml"===e.mediaType));if(!I.length)throw new Error("No package document defined in container");const L=I[0].fullPath,E=await(0,r.A)(this,Ae)[Ae](L);if(!E)throw new Error("Failed to load package document");const B=await(0,r.A)(this,Ae)[Ae]("META-INF/encryption.xml");await(0,r.A)(this,ge)[ge].init(B,E),this.resources=new de({opf:E,resolveHref:e=>w(e,L)}),(0,r.A)(this,me)[me]=new fe({loadText:this.loadText,loadBlob:e=>Promise.resolve(this.loadBlob(e)).then((0,r.A)(this,ge)[ge].getDecoder(e)),resources:this.resources}),this.sections=this.resources.spine.map(((e,t)=>{const{idref:i,linear:n,properties:s=[]}=e,o=this.resources.getItemByID(i);return o?{id:o.href,load:()=>(0,r.A)(this,me)[me].loadItem(o),unload:()=>(0,r.A)(this,me)[me].unloadItem(o),createDocument:()=>this.loadDocument(o),size:this.getSize(o.href),cfi:this.resources.cfis[t],linear:n,pageSpread:ve(s),resolveHref:e=>w(e,o.href),mediaOverlay:o.mediaOverlay?this.resources.getItemByID(o.mediaOverlay):null}:(console.warn('Could not find item with ID "'.concat(i,'" in manifest')),null)})).filter((e=>e));const{navPath:C,ncxPath:M}=this.resources;if(C)try{const e=e=>w(e,C),t=P(await(0,r.A)(this,Ae)[Ae](C),e);this.toc=t.toc,this.pageList=t.pageList,this.landmarks=t.landmarks}catch(D){console.warn(D)}if(!this.toc&&M)try{const e=e=>w(e,M),t=j(await(0,r.A)(this,Ae)[Ae](M),e);this.toc=t.toc,this.pageList=t.pageList}catch(D){console.warn(D)}null!==(e=this.landmarks)&&void 0!==e||(this.landmarks=this.resources.guide);const{metadata:N,rendition:R,media:U}=(e=>{const{$:t,$$:i}=b(e,l),r=t(e.documentElement,"metadata"),n=Array.from(r.children),s=(e,t)=>{var i;if(!t)return null;const{props:r=[],attrs:o=[]}=e,a=y(t);if(!r.length&&!o.length)return a;const l=t.getAttribute("id"),c=l?n.filter(g("refines","#"+l)):[],d=Object.fromEntries([["value",a]].concat(r.map((t=>{const{many:i,recursive:r}=t,n="string"===typeof t?t:t.name,o=g("property",n),a=r?e:t;return[m(n),i?c.filter(o).map((e=>s(a,e))):s(a,c.find(o))]}))).concat(o.map((e=>[m(e),t.getAttribute(e)]))));return null===(i=e.setLegacyAttrs)||void 0===i||i.call(e,d,t),d},o=n.filter(g("refines",null)),a=Object.fromEntries(O.map((e=>{const{type:t,name:i,many:r}=e,n="meta"===t?e=>e.namespaceURI===l&&e.getAttribute("property")===i:e=>e.namespaceURI===d&&e.localName===i;return[m(i),r?o.filter(n).map((t=>s(e,t))):s(e,o.find(n))]}))),c=i(r,"meta"),u=e=>c.filter(g("property",(t=>null===t||void 0===t?void 0:t.startsWith(e)))).map((t=>[t.getAttribute("property").replace(e,""),t])),h=Object.fromEntries(u("rendition:").map((e=>{let[t,i]=e;return[t,y(i)]}))),p={narrator:[],duration:{}};for(const[l,d]of u("media:")){var f,v,A;const e=y(d);"duration"===l?p.duration[null!==(f=null===(v=d.getAttribute("refines"))||void 0===v||null===(A=v.split("#"))||void 0===A?void 0:A[1])&&void 0!==f?f:""]=k(e):"active-class"===l?p.activeClass=e:"narrator"===l?p.narrator.push(e):"playback-active-class"===l&&(p.playbackActiveClass=e)}return{metadata:a,rendition:h,media:p}})(E);this.rendition=R,this.media=U,this.dir=this.resources.pageProgressionDirection,this.parsedMetadata=N;const $=null===N||void 0===N||null===(t=N.title)||void 0===t?void 0:t[0];this.metadata={title:null===$||void 0===$?void 0:$.value,subtitle:null===N||void 0===N||null===(i=N.title)||void 0===i||null===(n=i.find((e=>"subtitle"===e.titleType)))||void 0===n?void 0:n.value,sortAs:null===$||void 0===$?void 0:$.fileAs,language:null===N||void 0===N?void 0:N.language,identifier:ie(E),description:null===N||void 0===N||null===(s=N.description)||void 0===s?void 0:s.value,publisher:null===N||void 0===N||null===(a=N.publisher)||void 0===a?void 0:a.value,published:null===N||void 0===N?void 0:N.date,modified:null===N||void 0===N?void 0:N.dctermsModified,subject:null===N||void 0===N||null===(c=N.subject)||void 0===c||null===(u=c.filter((e=>{let{value:t,term:i}=e;return t||i})))||void 0===u?void 0:u.map((e=>{let{value:t,term:i,authority:r}=e;return{name:t,code:i,scheme:r}})),rights:null===N||void 0===N||null===(h=N.rights)||void 0===h?void 0:h.value};const H={art:"artist",aut:"author",bkp:"producer",clr:"colorist",edt:"editor",ill:"illustrator",nrt:"narrator",trl:"translator",pbl:"publisher"},F=e=>t=>{var i;const r=[...new Set(null===(i=t.role)||void 0===i?void 0:i.map((t=>{var i;let{value:r,scheme:n}=t;return null!==(i=n&&"marc:relators"!==n?null:H[r])&&void 0!==i?i:e})))],n={name:t.value,sortAs:t.fileAs};return[null!==r&&void 0!==r&&r.length?r:[e],n]};return null===N||void 0===N||null===(p=N.creator)||void 0===p||null===(f=p.map(F("author")))||void 0===f||null===(v=f.concat(null===N||void 0===N||null===(S=N.contributor)||void 0===S||null===(x=S.map)||void 0===x?void 0:x.call(S,F("contributor"))))||void 0===v||v.forEach((e=>{let[t,i]=e;return t.forEach((e=>{this.metadata[e]?this.metadata[e].push(i):this.metadata[e]=[i]}))})),this}async loadDocument(e){const t=await this.loadText(e.href);return this.parser.parseFromString(t,e.mediaType)}getMediaOverlay(){return new W(this,(0,r.A)(this,Ae)[Ae].bind(this))}resolveCFI(e){return this.resources.resolveCFI(e)}resolveHref(e){const[t,i]=e.split("#"),r=this.resources.getItemByHref(decodeURI(t));if(!r)return null;return{index:this.resources.spine.findIndex((e=>{let{idref:t}=e;return t===r.id})),anchor:i?e=>((e,t)=>{var i;return null!==(i=e.getElementById(t))&&void 0!==i?i:e.querySelector('[name="'.concat(CSS.escape(t),'"]'))})(e,i):()=>0}}splitTOCHref(e){var t;return null!==(t=null===e||void 0===e?void 0:e.split("#"))&&void 0!==t?t:[]}getTOCFragment(e,t){var i;return null!==(i=e.getElementById(t))&&void 0!==i?i:e.querySelector('[name="'.concat(CSS.escape(t),'"]'))}isExternal(e){return S(e)}async getCover(){var e;const t=null===(e=this.resources)||void 0===e?void 0:e.cover;return null!==t&&void 0!==t&&t.href?new Blob([await this.loadBlob(t.href)],{type:t.mediaType}):null}async getCalibreBookmarks(){const e=await this.loadText("META-INF/calibre_bookmarks.txt"),t="encoding=json+base64:";if(null!==e&&void 0!==e&&e.startsWith(t)){const t=atob(e.slice(21));return JSON.parse(t)}}destroy(){var e;null===(e=(0,r.A)(this,me)[me])||void 0===e||e.destroy()}}async function be(e){const t=await this.loadText(e);if(!t)return null;const i=this.parser.parseFromString(t,v.XML);if(i.querySelector("parsererror"))throw new Error("XML parsing error: ".concat(e,"\n").concat(i.querySelector("parsererror").innerText));return i}}}]);
//# sourceMappingURL=242.abdafc9f.chunk.js.map